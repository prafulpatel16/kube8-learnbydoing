Overview of k8s components

1. Create a mongodb deployment yaml first
2. Create a mongodb secret yaml and run that before mongodb deployment so that it can associate the mongo db secret credentials to the
mongodb deployment.




- Check the deployment first on master node if any other deployment and services exists''

root@master-node-ubnt:~# kubectl get all
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   7d22h
root@master-node-ubnt:~# 

Only default services exists, nothing else running on kub8s

- Now create a mongodb secret on master node

kubectl apply -f https://raw.githubusercontent.com/prafulpatel16/kube8-learnbydoing/master/mongo_appdeployment/mongo_secret.yml

root@master-node-ubnt:~# kubectl apply -f https://raw.githubusercontent.com/prafulpatel16/kube8-lea
rnbydoing/master/mongo_appdeployment/mongo_secret.yml
secret/mongodb-secret created

-check if the mongodb-secret is displayed

root@master-node-ubnt:~# kubectl get secret
NAME                  TYPE                                  DATA   AGE
default-token-7mk7n   kubernetes.io/service-account-token   3      7d22h
mongodb-secret        Opaque                                2      64s

- Now go to mongodb-deployment yaml file and associate and give key Ref the mongodb secret key values

apiVersion: apps/v1
kind: Deployment
metadata:
  name: mongodb-deployment
  labels:
    app: mongodb
spec:
  replicas: 2
  selector:
    matchLabels:
      app: mongodb
  template:
    metadata:
      labels:
        app: mongodb
    spec:
      containers:
      - name: mongodb
        image: mongo
        ports:
        - containerPort: 27017
        env:
        - name: MONGO_INITDB_ROOT_USERNAME
          valueFrom:
            secretKeyRef:
              name: mongodb-secret
              key: mongo-root-username
        - name: MONGO_INITDB_ROOT_PASSWORD
          valueFrom:
            secretKeyRef: 
              name: mongodb-secret
              key: mongo-root-password 

- Now go to master node and create mongodb-deployment 

kubectl apply -f https://raw.githubusercontent.com/prafulpatel16/kube8-learnbydoing/master/mongo_appdeployment/mogodb-deployment.yml

root@master-node-ubnt:~# kubectl apply -f https://raw.githubusercontent.com/prafulpatel16/kube8-lea
rnbydoing/master/mongo_appdeployment/mogodb-deployment.yml
deployment.apps/mongodb-deployment created

mongodb-deployment created successfully, 
verify the mongodb deployment, replicaset and pods are created

root@master-node-ubnt:~# kubectl get all
NAME                                     READY   STATUS    RESTARTS   AGE
pod/mongodb-deployment-8f6675bc5-8dkt5   1/1     Running   0          2m16s
pod/mongodb-deployment-8f6675bc5-vdsv8   1/1     Running   0          2m16s
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   7d22h
NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/mongodb-deployment   2/2     2            2           2m16s
NAME                                           DESIRED   CURRENT   READY   AGE
replicaset.apps/mongodb-deployment-8f6675bc5   2         2         2       2m16s
root@master-node-ubnt:~# kubectl get pods
NAME                                 READY   STATUS    RESTARTS   AGE
mongodb-deployment-8f6675bc5-8dkt5   1/1     Running   0          2m41s
mongodb-deployment-8f6675bc5-vdsv8   1/1     Running   0          2m41s

root@master-node-ubnt:~# kubectl get deployment 
NAME                 READY   UP-TO-DATE   AVAILABLE   AGE
mongodb-deployment   2/2     2            2           88s

Validate that alongwith the mongodb deployment there is a replicaset also created 











